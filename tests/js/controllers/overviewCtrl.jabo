var config = require("config");
var should = require("should");

require("../angular-helper");
require("../../../js/app.js");

describe('overviewCtrl tests:', function(){
  var scope;
  var ctrl;
  var $httpBackend;
  var appName = config.get('Client.appName');

  beforeEach(ngModule(appName));

  beforeEach(inject(function($rootScope, $controller, _$httpBackend_){
    scope = $rootScope.$new();
    ctrl = $controller('overviewCtrl', {$scope: scope});
    $httpBackend = _$httpBackend_;

    $httpBackend.when('GET','/api/bitcoind/getpeerinfo')
    .respond(200, [{
      id: 0,
      addr: '127.0.0.1:5555',
      addrlocal: '127.0.0.1:6666',
      subver: 'Satoshi',
      inbound: true
    }]);
    $httpBackend.flush();

  }));

  afterEach(function(){
    $httpBackend.verifyNoOutstandingExpectation();
    $httpBackend.verifyNoOutstandingRequest();
  });

  it('it should retrieve a list of peers when calling /api/bitcoind/getpeerinfo and save it to $scope.peers', function(){
    $httpBackend(
    scope.peers.id.should.be.equal(0);
    scope.peers.addr.should.be.equal('127.0.0.1:5555');
    scope.peers.addlocal.should.be.equal('127.0.0.1:6666');
    scope.peers.subver.should.be.equal('Satoshi');
    scope.peers.subver.should.be.equal(true);
  });

});
